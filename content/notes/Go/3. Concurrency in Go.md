---
title: Goè¯­è¨€ä¸­çš„å¹¶å‘
date: 2025-12-2
tags: [go,å­¦ä¹ ç¬”è®°]
cover: /covers/go/golang-banner.png
---

# Concurrency in Go

> Go å¹¶å‘æ¨¡åž‹ç³»ç»Ÿæ•´ç†ç‰ˆ

---

## 1. å¹¶å‘ vs å¹¶è¡Œ

| æ¦‚å¿µ | å«ä¹‰ |
|---|---|
| Concurrency | ä»»åŠ¡æ—¶é—´é‡å  |
| Parallelism | ç‰©ç†åŒæ—¶æ‰§è¡Œ |

- å¹¶å‘ â‰  å¹¶è¡Œ
- å¹¶å‘æ˜¯è®¾è®¡æ¨¡åž‹

---

## 2. ä¸ºä»€ä¹ˆéœ€è¦å¹¶å‘

- æå‡åžåé‡
- éšè— I/O å»¶è¿Ÿ
- æ›´å¥½åˆ©ç”¨å¤šæ ¸

çŽ°å®žç±»æ¯”ï¼š
- ä¸€ä¸ªåŽ¨å¸ˆåˆ‡æ¢åšå¤šé“èœï¼ˆå¹¶å‘ï¼‰
- å¤šä¸ªåŽ¨å¸ˆåŒæ—¶åšèœï¼ˆå¹¶è¡Œï¼‰

---

## 3. å†¯Â·è¯ºä¾æ›¼ç“¶é¢ˆ

- CPU é€Ÿåº¦ > å†…å­˜é€Ÿåº¦
- ç¼“å­˜æ— æ³•æ— é™æå‡
- å•æ ¸é¢‘çŽ‡å—é™ï¼ˆPower Wallï¼‰

ç»“è®ºï¼š
ðŸ‘‰ è½¯ä»¶å¹¶å‘æˆä¸ºä¸»æµ

---

## 4. è¿›ç¨‹ / çº¿ç¨‹ / Goroutine

| æ¦‚å¿µ | ç‰¹ç‚¹ |
|---|---|
| Process | ç‹¬ç«‹åœ°å€ç©ºé—´ |
| Thread | å…±äº«è¿›ç¨‹å†…å­˜ |
| Goroutine | æžè½»é‡çº¿ç¨‹ |

---

## 5. Goroutine

```go
go func() {
    fmt.Println("hello")
}()
```

- å¯åŠ¨æˆæœ¬æžä½Ž
- å¯åˆ›å»ºæˆåƒä¸Šä¸‡

---

## 6. Go Runtime Scheduler

- Gï¼šgoroutine
- Mï¼šOS thread
- Pï¼šé€»è¾‘å¤„ç†å™¨

```go
runtime.GOMAXPROCS(4)
```

Go è‡ªå¸¦è°ƒåº¦å™¨ï¼ˆç”¨æˆ·æ€ï¼‰

---

## 7. å¹¶å‘æ‰§è¡Œç‰¹ç‚¹

- é¡ºåºä¸å¯é¢„æµ‹
- æ‰§è¡Œå¯èƒ½äº¤é”™ï¼ˆInterleavingï¼‰

```go
go fmt.Println("A")
go fmt.Println("B")
```

---

## 8. Race Condition

- å¤š goroutine åŒæ—¶è®¿é—®å…±äº«æ•°æ®
- è‡³å°‘ä¸€ä¸ªå†™

```go
// éžå®‰å…¨ç¤ºä¾‹
counter++
```

---

## 9. é€šä¿¡ vs å…±äº«å†…å­˜

Go æŽ¨èï¼š
> **Do not communicate by sharing memory; share memory by communicating**

---

## 10. Channel

```go
ch := make(chan int)

ch <- 1
x := <-ch
```

- é˜»å¡žé€šä¿¡
- ç”¨äºŽåŒæ­¥

---

## 11. Buffered Channel

```go
ch := make(chan int, 3)
```

- æœ‰ç¼“å†²
- æé«˜åžå

---

## 12. select

```go
select {
case v := <-ch1:
case ch2 <- x:
default:
}
```

---

## 13. å¸¸è§å¹¶å‘æ¨¡å¼

- Worker Pool
- Fan-in / Fan-out
- Pipeline

---

## 14. Mutexï¼ˆè¡¥å……ï¼‰

```go
var mu sync.Mutex
mu.Lock()
mu.Unlock()
```

ç”¨äºŽä¿æŠ¤å…±äº«èµ„æº

---

## æœ¬ç« æ€»ç»“

- å¹¶å‘æ˜¯ Go çš„æ€æ‰‹çº§ç‰¹æ€§
- Goroutine + Channel = CSP æ¨¡åž‹
- ä¼˜å…ˆç”¨é€šä¿¡è€Œéžå…±äº«å†…å­˜


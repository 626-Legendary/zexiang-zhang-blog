---
title: 二进制与位运算 
date: 2025-12-26
tags: [数据结构与算法,学习笔记,Python]
cover: /covers/数据结构与算法/二进制与位运算.png
---

# 二进制与位运算 

## 1. 二进制表示

* `bin(x)` → `'0b...'` 字符串
* `format(x, '08b')` → 固定 8 位二进制字符串
* Python int 没有固定位数，需要用掩码截断

```python
num = 5
print(bin(num))           # 0b101
print(format(num,'08b'))  # 00000101
```

---

## 2. 位运算符

| 运算符  | 名称   | 说明           |            |
| ---- | ---- | ------------ | ---------- |
| `&`  | 按位与  | 两位都 1 才是 1   |            |
| `    | `    | 按位或          | 有一个 1 就是 1 |
| `^`  | 按位异或 | 相同为 0，不同为 1  |            |
| `~`  | 按位取反 | 0 ↔ 1（补码规则）  |            |
| `<<` | 左移   | 左移补 0，相当于 ×2 |            |
| `>>` | 右移   | 算术右移，补符号位    |            |

```python
a = 5  # 00000101
b = 3  # 00000011
print(a & b)  # 1
print(a | b)  # 7
print(a ^ b)  # 6
print(~a)     # -6
print(a << 1) # 10
print(b >> 1) # 1
```

---

## 3. 补码与固定位数

* Python int 不固定位数
* 负数按补码计算：`~x = -x-1`
* 固定 n 位可用掩码 `& ((1<<n)-1)` 或自定义函数：

```python
def bin8(x):
    return format(x & 0xff,'08b')

num = -8
print(bin8(num))  # 11111000
```

---

## 4. 位扫描

* 逐位扫描整数的二进制表示

```python
num = 85  # 01010101
bits = ""
for i in range(7,-1,-1):
    bits += str((num >> i) & 1)
print(bits)  # 01010101
```

---

## 5. 位运算技巧

1. **不用临时变量交换两个数**

```python
x = 7
y = 3
x ^= y
y ^= x
x ^= y
print(x, y)  # 3 7
```

2. **权限位示例**

```python
READ  = 0b00000100
WRITE = 0b00000010
EXEC  = 0b00000001
perm  = 0b00000110

bool(perm & READ)  # True
bool(perm & WRITE) # True
bool(perm & EXEC)  # False
```

3. **判断奇偶**

```python
num = 13
num & 1  # 1 -> 奇数
```

---

## 6. 浮点数简介

* Python 浮点数遵循 **IEEE 754**
* 单精度 32 位：S(1) | E(8) | M(23)
* 双精度 64 位：S(1) | E(11) | M(52)
* 公式：`(-1)^S * 1.M * 2^(E-bias)`

```python
import struct
x = 6.5
bits32 = struct.unpack('>I', struct.pack('>f', x))[0]
print(format(bits32,'032b'))  # 32 位二进制表示
```

---

# 练习题

## 题 1 基础位运算

```python
x = 5
y = 3
# 1. x & y
# 2. x | y
# 3. x ^ y
# 写出十进制和 8 位二进制
```

## 题 2 左移与右移

```python
x = 12
# 1. x << 1
# 2. x >> 2
# 十进制 + 8 位二进制
```

## 题 3 补码理解

```python
x = -1
# 1. 8 位补码
# 2. ~x 十进制
# 3. ~x 8 位补码
```

## 题 4 位掩码（权限位）

```python
READ  = 0b00000100
WRITE = 0b00000010
EXEC  = 0b00000001
perm  = 0b00000110

# 判断 perm 是否有 READ / WRITE / EXEC 权限
```

## 题 5 异或交换

```python
a = 7
b = 3
# 用 a ^= b 技巧交换 a,b
# 输出交换后的 a,b
```

## 题 6 位扫描

```python
x = 10
# 按位扫描 8 位二进制，得到字符串
```

---

# 答案

## 题 1

```
x = 5 -> 00000101
y = 3 -> 00000011

x & y = 1  -> 00000001
x | y = 7  -> 00000111
x ^ y = 6  -> 00000110
```

## 题 2

```
x = 12 -> 00001100
x << 1 = 24 -> 00011000
x >> 2 = 3  -> 00000011
```

## 题 3

```
x = -1 -> 8 位补码 11111111
~x = 0
~x 8 位补码 = 00000000
```

## 题 4

```
perm = 00000110
READ?  True
WRITE? True
EXEC?  False
```

## 题 5

```
交换后 a,b = 3,7
```

## 题 6

```
x = 10 -> 00001010
逐位扫描结果 = 00001010
```

## 相关代码

```python
# ==============================
# 二进制和位运算（8 位视角）
# ==============================

"""
位运算 vs 逻辑运算（一定要区分）：
位运算：对 二进制位 操作
逻辑运算：对 True / False 操作

位运算符：
&   按位与     两位都 1 才是 1
|   按位或     有一个 1 就是 1
^   按位异或   相同为 0，不同为 1
~   按位取反   0 ↔ 1（注意补码）
<<  左移       左移补 0（相当于 ×2）
>>  右移       算术右移（补符号位）
"""

# ==============================
# 工具函数：统一 8 位二进制显示
# ==============================
def bin8(x):
    """
    将整数按 8 位补码形式显示
    关键点：
    - Python int 没有固定位数
    - & 0xff 用来“截断”为 8 位
    """
    return format(x & 0xff, "08b")


print("========== 按位与 & ==========")
# &：两位都为 1 才是 1
num1 = 1   # 00000001
num2 = 1   # 00000001
print(f"num1 = {bin8(num1)}")
print(f"num2 = {bin8(num2)}")
print("num1 & num2 =", bin8(num1 & num2))  # 00000001
print()

num1 = 1   # 00000001
num2 = 2   # 00000010
print(f"num1 = {bin8(num1)}")
print(f"num2 = {bin8(num2)}")
print("num1 & num2 =", bin8(num1 & num2))  # 00000000
print()


print("========== 按位或 | ==========")
# |：有一个为 1 就是 1
num1 = 1
num2 = 2
print(f"num1 = {bin8(num1)}")
print(f"num2 = {bin8(num2)}")
print("num1 | num2 =", bin8(num1 | num2))  # 00000011
print()


print("========== 按位异或 ^ ==========")
# ^：相同为 0，不同为 1
num1 = 1
num2 = 1
print(f"num1 = {bin8(num1)}")
print(f"num2 = {bin8(num2)}")
print("num1 ^ num2 =", bin8(num1 ^ num2))  # 00000000
print()

num1 = 1
num2 = 2
print(f"num1 = {bin8(num1)}")
print(f"num2 = {bin8(num2)}")
print("num1 ^ num2 =", bin8(num1 ^ num2))  # 00000011
print()


print("========== 按位取反 ~ ==========")
# ~x = -x - 1（补码规则）
num1 = 1
print(f"num1     = {bin8(num1)}")
print(f"~num1    = {bin8(~num1)}")  # 11111110
print("说明：~00000001 = 11111110（8 位补码）")
print()


print("========== 左移 << ==========")
# 左移：低位补 0，相当于 ×2
num1 = 3  # 00000011
print(f"num1        = {bin8(num1)}")
print(f"num1 << 1   = {bin8(num1 << 1)}")  # 00000110
print(f"num1 << 2   = {bin8(num1 << 2)}")  # 00001100
print()


print("========== 右移 >> ==========")
# 右移：算术右移（补符号位）
num1 = -8
print(f"num1        = {bin8(num1)}")
print(f"num1 >> 1   = {bin8(num1 >> 1)}")  # 11111100
print()


print("========== 十进制 → 二进制（位扫描法） ==========")
"""
这是“教学用写法”，不是最快
目的：
- 理解每一位是怎么来的
- 理解掩码 & 和移位 >>
"""

num1 = 85  # 十进制 85
# 二进制：01010101
print("num1 =", num1)
print("bin(num1) =", bin(num1))
print("8 位补码  =", bin8(num1))

result = ""
for i in range(7, -1, -1):
    # 右移 i 位，再 & 1，取出当前位
    bit = (num1 >> i) & 1
    result += str(bit)

print("位扫描结果 =", result)
print()


print("========== 重要结论（笔记） ==========")
print("""
1. Python int 没有固定 8/32/64 位
2. 位运算结果本身是“无限位”的
3. 显示为 8 位，必须：
   - 使用掩码：& 0xff
   - 再用 format(..., '08b')
4. bin(x) 显示的是“数值”，不是“内存补码”
5. 教学 / 计组 / OS：一定要先规定“位宽”
""")

```